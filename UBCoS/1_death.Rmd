---
title: "Death"
output: 
  html_document:
    theme: united
    highlight: tango
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true 
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("setup_ubcos.r")
```
<!-- ########################################################## --> 

# Description of DataSchema variable 

Three variables are created: day, month and year of death.

* Short names: `ddeath`, `mdeath` and `ydeath`
* Variable label: `day of death`, `month of death` and `year of death`
* Variable description: `Day, month and year of death`
* Value type: `continuous`
* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not applicable
995 | Does not answer
996 | Not attempt/not done
997 | Refuse
998 | Do not know
999 | Missing

```{r lab, echo=FALSE}
ds_label_d <- "Day of death"
ds_label_m <- "Month of death"
ds_label_y <- "Year of death"
c_label    <- c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991)
```

<!-- ########################################################## --> 

# Data process

## Uppsala 1st generation cohort

### Wave 1

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W1`
* Description: 

```{r frqg1w1, echo=FALSE}
sds <- ubcosG1W1[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w1}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1915-01-01'), ymd('1960-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w1, echo=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.

**R script:**
```{r crosstabulationg1w1}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w1, echo=FALSE}
load("UBCoS_g1_w1.rdata")
UBCoS_g1_w1 <- full_join(UBCoS_g1_w1, hds, by="id", all=TRUE)
#save(UBCoS_g1_w1, file="UBCoS_g1_w1.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w1.rdata")
UBCoS_m_g1_w1 <- full_join(UBCoS_m_g1_w1, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w1, file="UBCoS_m_g1_w1.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 


### Wave 2

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W2`
* Description: 

```{r frqg1w2, echo=FALSE}
sds <- ubcosG1W2[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w2}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1960-11-02'), ymd('1970-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w2, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg1w2}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w2, echo=FALSE}
load("UBCoS_g1_w2.rdata")
UBCoS_g1_w2 <- full_join(UBCoS_g1_w2, hds, by="id", all=TRUE)
#save(UBCoS_g1_w2, file="UBCoS_g1_w2.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w2.rdata")
UBCoS_m_g1_w2 <- full_join(UBCoS_m_g1_w2, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w2, file="UBCoS_m_g1_w2.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 3

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W3`
* Description: 

```{r frqg1w3, echo=FALSE}
sds <- ubcosG1W3[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w3}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1970-11-02'), ymd('1980-09-15')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w3, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg1w3}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w3, echo=FALSE}
load("UBCoS_g1_w3.rdata")
UBCoS_g1_w3 <- full_join(UBCoS_g1_w3, hds, by="id", all=TRUE)
#save(UBCoS_g1_w3, file="UBCoS_g1_w3.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w3.rdata")
UBCoS_m_g1_w3 <- full_join(UBCoS_m_g1_w3, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w3, file="UBCoS_m_g1_w3.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 4

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W4`
* Description: 

```{r frqg1w4, echo=FALSE}
sds <- ubcosG1W4[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w4}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1980-09-16'), ymd('1990-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w4, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg1w4}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w4, echo=FALSE}
load("UBCoS_g1_w4.rdata")
UBCoS_g1_w4 <- full_join(UBCoS_g1_w4, hds, by="id", all=TRUE)
#save(UBCoS_g1_w4, file="UBCoS_g1_w4.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w4.rdata")
UBCoS_m_g1_w4 <- full_join(UBCoS_m_g1_w4, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w4, file="UBCoS_m_g1_w4.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 5

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W5`
* Description: 

```{r frqg1w5, echo=FALSE}
sds <- ubcosG1W5[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w5}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1990-11-02'), ymd('2000-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w5, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg1w5}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w5, echo=FALSE}
load("UBCoS_g1_w5.rdata")
UBCoS_g1_w5 <- full_join(UBCoS_g1_w5, hds, by="id", all=TRUE)
#save(UBCoS_g1_w5, file="UBCoS_g1_w5.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w5.rdata")
UBCoS_m_g1_w5 <- full_join(UBCoS_m_g1_w5, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w5, file="UBCoS_m_g1_w5.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 6

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG1W6`
* Description: 

```{r frqg1w6, echo=FALSE}
sds <- ubcosG1W6[c("athlosid", "date_death", "ubcos1")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog1w6}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('2000-11-02'), ymd('2008-12-31')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg1w6, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg1w6}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2010, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg1w6, echo=FALSE}
load("UBCoS_g1_w6.rdata")
UBCoS_g1_w6 <- full_join(UBCoS_g1_w6, hds, by="id", all=TRUE)
#save(UBCoS_g1_w6, file="UBCoS_g1_w6.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g1_w6.rdata")
UBCoS_m_g1_w6 <- full_join(UBCoS_m_g1_w6, mds, by="id", all=TRUE)
#save(UBCoS_m_g1_w6, file="UBCoS_m_g1_w6.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 
<!-- ########################################################## --> 
<!-- ########################################################## --> 

<!-- ########################################################## --> 

## Uppsala 2nd generation cohort

### Wave 1

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W1`
* Description: 

```{r frqg2w1, echo=FALSE}
sds <- ubcosG2W1[c("athlosid", "date_death", "ubcos2")]
#ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
#ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
#ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```
No deaths were found.

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w1}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1915-01-02'), ymd('1960-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

Harmonised variables are all missing.

Only register data is available for the follow-up of the 2nd generation. The cause of death data start in 1950s and hospitalisations start in 1960s.


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w1, echo=FALSE}
load("UBCoS_g2_w1.rdata")
UBCoS_g2_w1 <- full_join(UBCoS_g2_w1, hds, by="id", all=TRUE)
#save(UBCoS_g2_w1, file="UBCoS_g2_w1.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w1.rdata")
UBCoS_m_g2_w1 <- full_join(UBCoS_m_g2_w1, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w1, file="UBCoS_m_g2_w1.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 


### Wave 2

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W2`
* Description: 

```{r frqg2w2, echo=FALSE}
sds <- ubcosG2W2[c("athlosid", "date_death", "ubcos2")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w2}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1960-11-02'), ymd('1970-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg2w2, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg2w2}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```



<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w2, echo=FALSE}
load("UBCoS_g2_w2.rdata")
UBCoS_g2_w2 <- full_join(UBCoS_g2_w2, hds, by="id", all=TRUE)
#save(UBCoS_g2_w2, file="UBCoS_g2_w2.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w2.rdata")
UBCoS_m_g2_w2 <- full_join(UBCoS_m_g2_w2, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w2, file="UBCoS_m_g2_w2.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 3

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W3`
* Description: 

```{r frqg2w3, echo=FALSE}
sds <- ubcosG2W3[c("athlosid", "date_death", "ubcos2")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w3}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1970-11-02'), ymd('1980-09-15')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg2w3, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg2w3}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w3, echo=FALSE}
load("UBCoS_g2_w3.rdata")
UBCoS_g2_w3 <- full_join(UBCoS_g2_w3, hds, by="id", all=TRUE)
#save(UBCoS_g2_w3, file="UBCoS_g2_w3.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w3.rdata")
UBCoS_m_g2_w3 <- full_join(UBCoS_m_g2_w3, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w3, file="UBCoS_m_g2_w3.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 4

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W4`
* Description: 

```{r frqg2w4, echo=FALSE}
sds <- ubcosG2W4[c("athlosid", "date_death", "ubcos2")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w4}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1980-09-16'), ymd('1990-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg2w4, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg2w4}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w4, echo=FALSE}
load("UBCoS_g2_w4.rdata")
UBCoS_g2_w4 <- full_join(UBCoS_g2_w4, hds, by="id", all=TRUE)
#save(UBCoS_g2_w4, file="UBCoS_g2_w4.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w4.rdata")
UBCoS_m_g2_w4 <- full_join(UBCoS_m_g2_w4, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w4, file="UBCoS_m_g2_w4.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 5

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W5`
* Description: 

```{r frqg2w5, echo=FALSE}
sds <- ubcosG2W5[c("athlosid", "date_death", "ubcos2")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w5}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('1990-11-02'), ymd('2000-11-01')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg2w5, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg2w5}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w5, echo=FALSE}
load("UBCoS_g2_w5.rdata")
UBCoS_g2_w5 <- full_join(UBCoS_g2_w5, hds, by="id", all=TRUE)
#save(UBCoS_g2_w5, file="UBCoS_g2_w5.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w5.rdata")
UBCoS_m_g2_w5 <- full_join(UBCoS_m_g2_w5, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w5, file="UBCoS_m_g2_w5.rdata")

rm(list = c("hds", "sds", "mds"))
```

<!-- ########################################################## --> 

### Wave 6

#### Study-specific variable description

* Name: `date_death`
* Label: `date of death`
* Table name: `ubcosG2W6`
* Description: 

```{r frqg2w6, echo=FALSE}
sds <- ubcosG2W6[c("athlosid", "date_death", "ubcos2")]

ggplot(sds, aes(x=day(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(sds, aes(x=month(sds[[2]]))) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(sds, aes(x=year(sds[[2]]))) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Harmonisation algorithm

Study-specific variables `ydeath`, `mdeath` and `ddeath` are just the same DataSchema variables. No missing values were found. Therefore, these variables are copied as they are and only missing categories were included. 

**R script:**
```{r harmog2w6}
# 'sds': study dataset
# 'hds': harmonised dataset
sds$rdeath <- sds$date_death
sds$rdeath[!(sds$rdeath %within% interval(ymd('2000-11-02'), ymd('2008-12-31')))] <- NA
hds <- tibble(id=sds[[1]], ddeath=day(sds[[4]]), mdeath=month(sds[[4]]), ydeath=year(sds[[4]]))
hds[[2]] <- labelled(hds[[2]], labels = c_label)
hds[[3]] <- labelled(hds[[3]], labels = c_label)
hds[[4]] <- labelled(hds[[4]], labels = c_label)
```

#### Statistical description of the new harmonised variable

```{r descriptg2w6, echo=FALSE, message=FALSE}
ggplot(hds, aes(x=hds[[2]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 31, by =1), col="red") + xlab(ds_label_d)
ggplot(hds, aes(x=hds[[3]])) + geom_histogram(aes(), fill="steelblue", breaks=seq(0, 12, by =1), col="red") + xlab(ds_label_m)
ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```

#### Validation 

According to the following analyses:
* No differences were found between the study-specific variables and the new harmonized variables.
* Range of days rightly correspond to their respective months.
* Range of years of death from participants correspond to the original range from 1915 to 1929.

**R script:**
```{r crosstabulationg2w6}
taux <- merge(hds[,c("id","ydeath","mdeath","ddeath")], sds[,c("athlosid","date_death")], by.x="id", by.y="athlosid")
taux$dif.yb <- taux$ydeath - year(taux$date_death)
sum(taux$dif.yb)
taux$dif.mb <- taux$mdeath - month(taux$date_death)
sum(taux$dif.mb)
taux$dif.db <- taux$ddeath - day(taux$date_death)
sum(taux$dif.db)

grouped <- group_by(hds, mdeath)
summarise(grouped, min=min(ddeath), max=max(ddeath))

ggplot(hds, aes(x=hds[[4]])) + geom_histogram(aes(fill=factor(sds[[3]])), breaks=seq(1915, 2000, by =1), alpha=0.7, position = 'identity')  + scale_fill_manual(values=c("orange","steelblue"), labels=c("partners", "participants"), name="") + xlab(ds_label_y)
```


<!--- ################## Save harmonised datasets ###################-->
```{r importOPALg2w6, echo=FALSE}
load("UBCoS_g2_w6.rdata")
UBCoS_g2_w6 <- full_join(UBCoS_g2_w6, hds, by="id", all=TRUE)
#save(UBCoS_g2_w6, file="UBCoS_g2_w6.rdata")

mds <- hds
mds[[2]][mds[[2]] %in% c(991:999)] <- NA
val_labels(mds[[2]]) <- NULL
mds[[3]][mds[[3]] %in% c(991:999)] <- NA
val_labels(mds[[3]]) <- NULL
mds[[4]][mds[[4]] %in% c(991:999)] <- NA
val_labels(mds[[4]]) <- NULL
load("UBCoS_m_g2_w6.rdata")
UBCoS_m_g2_w6 <- full_join(UBCoS_m_g2_w6, mds, by="id", all=TRUE)
#save(UBCoS_m_g2_w6, file="UBCoS_m_g2_w6.rdata")

rm(list = c("hds", "sds", "mds"))
```
<!-- ########################################################## --> 
<!-- ########################################################## --> 
<!-- ########################################################## --> 


## Validation accross waves

Following analyses show that no inconsistences were found.

**R script for 1st generation:**
```{r crosstabulationg1}
list_df <- list(tibble(id= UBCoS_m_g1_w1$id, db1=UBCoS_m_g1_w1$ddeath, mb1=UBCoS_m_g1_w1$mdeath, yb1=UBCoS_m_g1_w1$ydeath),
                tibble(id= UBCoS_m_g1_w2$id, db2=UBCoS_m_g1_w2$ddeath, mb2=UBCoS_m_g1_w2$mdeath, yb2=UBCoS_m_g1_w2$ydeath),
                tibble(id= UBCoS_m_g1_w3$id, db3=UBCoS_m_g1_w3$ddeath, mb3=UBCoS_m_g1_w3$mdeath, yb3=UBCoS_m_g1_w3$ydeath), 
                tibble(id= UBCoS_m_g1_w4$id, db4=UBCoS_m_g1_w4$ddeath, mb4=UBCoS_m_g1_w4$mdeath, yb4=UBCoS_m_g1_w4$ydeath),
                tibble(id= UBCoS_m_g1_w5$id, db5=UBCoS_m_g1_w5$ddeath, mb5=UBCoS_m_g1_w5$mdeath, yb5=UBCoS_m_g1_w5$ydeath), 
                tibble(id= UBCoS_m_g1_w6$id, db6=UBCoS_m_g1_w6$ddeath, mb6=UBCoS_m_g1_w6$mdeath, yb6=UBCoS_m_g1_w6$ydeath))
MyMerge <- function(x, y){
  df <- full_join(x, y, by= "id")
  return(df)
}
new.df <- Reduce(MyMerge, list_df)


dll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("db1","db2","db3","db4","db5","db6")]), na.rm=T))
mll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("mb1","mb2","mb3","mb4","mb5","mb6")]), na.rm=T))
yll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("yb1","yb2","yb3","yb4","yb5","yb6")]), na.rm=T))
sum(as.numeric(dll), na.rm=T)
sum(as.numeric(mll), na.rm=T)
sum(as.numeric(yll), na.rm=T)
```

**R script for 2nd generation:**
```{r crosstabulationg2}
list_df <- list(tibble(id= UBCoS_m_g2_w1$id, db1=UBCoS_m_g2_w1$ddeath, mb1=UBCoS_m_g2_w1$mdeath, yb1=UBCoS_m_g2_w1$ydeath),
                tibble(id= UBCoS_m_g2_w2$id, db2=UBCoS_m_g2_w2$ddeath, mb2=UBCoS_m_g2_w2$mdeath, yb2=UBCoS_m_g2_w2$ydeath),
                tibble(id= UBCoS_m_g2_w3$id, db3=UBCoS_m_g2_w3$ddeath, mb3=UBCoS_m_g2_w3$mdeath, yb3=UBCoS_m_g2_w3$ydeath), 
                tibble(id= UBCoS_m_g2_w4$id, db4=UBCoS_m_g2_w4$ddeath, mb4=UBCoS_m_g2_w4$mdeath, yb4=UBCoS_m_g2_w4$ydeath),
                tibble(id= UBCoS_m_g2_w5$id, db5=UBCoS_m_g2_w5$ddeath, mb5=UBCoS_m_g2_w5$mdeath, yb5=UBCoS_m_g2_w5$ydeath), 
                tibble(id= UBCoS_m_g2_w6$id, db6=UBCoS_m_g2_w6$ddeath, mb6=UBCoS_m_g2_w6$mdeath, yb6=UBCoS_m_g2_w6$ydeath))
MyMerge <- function(x, y){
  df <- full_join(x, y, by= "id")
  return(df)
}
new.df <- Reduce(MyMerge, list_df)


dll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("db1","db2","db3","db4","db5","db6")]), na.rm=T))
mll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("mb1","mb2","mb3","mb4","mb5","mb6")]), na.rm=T))
yll <- lapply( 1:length(new.df$id), function(x) var(as.numeric(new.df[x,c("yb1","yb2","yb3","yb4","yb5","yb6")]), na.rm=T))
sum(as.numeric(dll), na.rm=T)
sum(as.numeric(mll), na.rm=T)
sum(as.numeric(yll), na.rm=T)
```

# Quality estimation

